(function(a){a.fn.retinafy=function(b,c){target=a(this);if(window.devicePixelRatio>=2){if(b!==false){var d=target.find("*").andSelf().filter(function(){return a(this).is("img")||a(this).css("backgroundImage")!=="none"});for(i=0;i<d.length;i++){var e=d[i];var f=a(e).attr("src");var g=a(e).css("background-image");function h(a){if(!a.complete){return false}if(typeof a.naturalWidth!="undefined"&&a.naturalWidth==0){return false}return true}function j(a){if(a.match(c)&&c!==undefined){return true}else if(!(!a.match(/^https?\:/i)||a.match("//"+document.domain))){return false}else{var b=new XMLHttpRequest;b.open("HEAD",a,false);b.send();return b.status!=404}}function k(){var b=a(e).width();var c=a(e).height();if(a(e).is("img")&&f.indexOf("@2x")==-1){var d=f.lastIndexOf(".");if(d!=-1){f=f.substr(0,d)+"@2x"+f.substr(d)}if(j(f)){a(e).attr("src",f);a(e).attr("width",b).height("height",c)}}}if(h(e)){k()}else{if(a(e).is("img")&&f.indexOf("@2x")==-1){e.onload=function(){k()}}else{var l=a(e).width();var m=a(e).height();var n=g;var o=n.lastIndexOf(".");if(o!=-1){n=n.substr(0,o)+"@2x"+n.substr(o)}var p=n;var p=p.substr(4);var p=p.substr(0,p.length-1);if(j(p)){a(e).css("background-image",n);a(e).css("background-size",l+"px ,"+m+"px")}}}}}return true}else{return false}}})(jQuery);