(function(a){a.fn.retinafy=function(b){target=a(this);if(window.devicePixelRatio>=2){if(b!==null){var c=target.find("*").andSelf().filter(function(){return a(this).is("img")||a(this).css("backgroundImage")!=="none"});for(i=0;i<c.length;i++){var d=c[i];var e=a(d).attr("src");var f=a(d).css("background-image");function g(a){if(!a.complete){return false}if(typeof a.naturalWidth!="undefined"&&a.naturalWidth==0){return false}return true}function h(a){if(!(!a.match(/^https?\:/i)||a.match("//"+document.domain))){return false}else{var b=new XMLHttpRequest;b.open("HEAD",a,false);b.send();return b.status!=404}}function j(){var b=a(d).width();var c=a(d).height();if(a(d).is("img")&&e.indexOf("@2x")==-1){var f=e.lastIndexOf(".");if(f!=-1){e=e.substr(0,f)+"@2x"+e.substr(f)}if(h(e)){a(d).attr("src",e);a(d).attr("width",b).height("height",c)}}}if(g(d)){j()}else{if(a(d).is("img")&&e.indexOf("@2x")==-1){d.onload=function(){j()}}else{var k=a(d).width();var l=a(d).height();var m=f;var n=m.lastIndexOf(".");if(n!=-1){m=m.substr(0,n)+"@2x"+m.substr(n)}var o=m;var o=o.substr(4);var o=o.substr(0,o.length-1);if(h(o)){a(d).css("background-image",m);a(d).css("background-size",k+"px ,"+l+"px")}}}}}return true}else{return false}}})(jQuery)